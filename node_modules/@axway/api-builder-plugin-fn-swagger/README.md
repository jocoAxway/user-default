# api-builder-plugin-fn-swagger

## About

This plugin searches for swagger documents in a swagger folder in your application and generates one flow-node per document to be used within [Axway API Builder's](https://www.axway.com/en/datasheet/axway-api-builder).

The generated flow-nodes export functions that can be used withing API Builder flows for communication with APIs services described in your swagger documents.


## Getting started

1. Follow the [Getting Started Guide](https://docs.axway.com/bundle/API_Builder_allOS_en/page/api_builder_getting_started_guide.html) to learn how to install and create API Builder application.

2. Then make sure you have the plugin installed within your application with:

```
npm install --no-optional @axway/api-builder-plugin-fn-swagger
```

## How to use the plugin?

1. During the **npm install** phase the swagger plugin will create a folder named `./swagger` in the root of you application. Note that if the folder already exists it will be preserved with all of its content.

2. Place your swagger JSON files into the `./swagger` folder.

3. (Optional) Place your service icons into the `./swagger` folder. The icon should have the same name as swagger JSON file for your service and should be one of the following formats - bmp | jpeg | jpg | png | gif | tiff | svg

4. Run your app with **npm start** and the flow-nodes will be available in the tool panel of your application. In the Connectors section, you should see a plugin listed for each JSON Swagger file successfully loaded from your `./swagger` folder.

5. Each flow-node will have a corresponding number of functions based on what has been described in the swagger JSON specification for particular service. Each of these functions could be used during the flow execution.

## Authorization

Authorization parameters described by each flow-node are supplied via the flow editor.

## How to configure the plugin?

The first time a new Swagger file is detected, a new configuration file is generated with the name of the Swagger file.  For example, if you installed "petstore.json", the plugin will generate `conf/petstore.default.js`.  You can configure the plugin using the configuration options below.

### Configuration options

| Option            | Type    | Required   | Description                                |
|-------------------|---------|------------|--------------------------------------------|
| **'proxy'**       | String  | _optional_ | The URL to use for outbound proxy requests |
| **'insecureSSL'** | Boolean | _optional_ | Enables insecure SSL on outbound requests  |
| **'uri'**         | Object  | _optional_ | Overrides the predefined endpoint URL.     |
|_**'uri.protocol'**| String  | _optional_ | Overrides the endpoint's HTTP protocol, one of: http, or https|
|_**'uri.host'**    | String  | _optional_ | Overrides the endpoint's hostname|
|_**'uri.port'**    | Number  | _optional_ | Overrides the endpoint's port (default depends on uri.protocol)|
|_**'uri.basePath'**| String  | _optional_ | Overrides the Swagger basePath|

## Known Limitations

The plugin has the following known limitations:

* Paths that deals with file upload/download are currently not supported

## Changes

#### 2.1.5
- #5488: Swagger plugin is no longer apply swagger validation with swagger-tools package

#### 2.1.4
- #5413: Swagger plugin will now fail on loading Swagger files with semantic validation problems

#### 2.1.0
- #5364: Support insecure SSL option on outbound requests `insecureSSL`.
- #5414: Prevent logging circular JSON references on error.

#### 2.0.5
- #5359: Log to the console to notify the user whenever configuration files are created on load.

#### 2.0.4
- #5360: No longer fail to load plugin when unsupported or invalid security definitions are defined in a provided swagger document. An error is now logged with the details instead.

#### 2.0.3
- #5392: Removed `config` from request log data and now only log specific request configuration options such as `proxy`.

#### 2.0.2
- #5395: Refactored tests.

#### 2.0.1
- #5349: Remove dependency on the enableAuthorizationInFlows preview flag.

#### 2.0.0
- #5384: Breaking Change: Previously, Swagger responses were mapped to outputs having `statusCode` property which was inconsistent with the rest of the product.  Now, responses are mapped to outputs having `status` property.
- #5073: Requests and responses to external Swagger services are now logged in detail.
- #5349: Breaking Change: Minimum supported version of API Builder is now Jakarta, which supports flow-nodes that advertise authentication parameters.
- #5314: Support generation of stub credentials from new Swagger documents loaded by the plugin.
- #5007: Breaking Change: Previously, there was no validation of the Swagger documents loaded by the plugin when the service was started. Now, the Swagger documents are validated and, if any are invalid, the loading of the plugin is aborted.
- #4919: Breaking Change: The configuration parameter `x-vendor-openapi-uri` has been renamed to `uri`.
- #4919: Replace `superagent` with `request` for http communication.
- #4918: Breaking Change: Previously, if a request to a method which documented an optional query parameter with a default value and was not supplied to the request, the default value would be sent to the service instead. Now, default values are not used when sending query parameters.
- #4918: Breaking Change: Removed support for the following credential configuration values. Authorization parameters should be provided in the flow editor instead:
	- `x-vendor-openapi-username`
	- `x-vendor-openapi-password`
	- `x-vendor-openapi-key`
	- `x-vendor-openapi-token`
- #5358: Breaking Change: Headers returned from service are no longer modified by us in the following cases:
	- Headers not defined by the Swagger are no longer removed from the output.
	- The case of header keys are not modified to match the Swagger definition.
	- Headers defined by the Swagger but not in the service response will not be ouput as undefined.
- #5358: Breaking Change: A `Default` output is created for all flow-nodes regardless of the Swagger definition.
- #5358: Breaking Change: An `Error` output is created for all flow-nodes to allow routing on connection errors.
- #5358: The default JSONPath selector for all outputs is now `$.response`. Only the Error output defaults to `$.error`.

#### 1.1.1
- #5177: Previously, Swagger plugin was taking specific configurations for all the available services in Swagger folder. Now, it takes optional `proxy` as additional parameter which is used for tunneling http/s requests through proxy server.

#### 1.0.19
- #5235: Previously, when an error occurred while loading multiple Swagger documents, the filename displayed in the error may refer to the wrong Swagger document. Now the correct file name is displayed.

#### 1.0.18
- #5116: Previously, when errors occurred on load, only the message was logged. Now, the stack trace is logged as well as the path to the Swagger file which caused the issue (if applicable).

#### 1.0.17
- #5111: Previously, Swagger documents with extensions in the same location as path methods failed to be loaded correctly. Now, extensions will be correctly ignored.

#### 1.0.16
- #5112: Previously, the server start would fail with a schema validation error when attempting to handle swaggers, that didn't contain the "definitions" section. Now, the loading of services with a swagger documents without the "definitions" section is allowed.

#### 1.0.15
- #5050: Updating license text.

#### 1.0.14
- #5004: Previously, the default configuration file generation did not preserve the service name during the creation of the initial service configuration file if the service had its service name manually changed, resulting in generating unique file name every time the service was restarted. Now, the swagger plugin generates configuration files by preserve the service name and stops once a config for the given service is created.

#### 1.0.12
- #4979: Previously, api-builder-plugin-fn-swagger generated incorrect inputs and outputs for flow-nodes when references were used in multiple places in the original swagger document. An example of the incorrect behaviour would be required parameters not being marked as required in the flow-node. Now, the generated flow-nodes will be generated correctly.

#### 1.0.8
- #4897: Previously, api-builder-plugin-fn-swagger failed on loading swagger files that specify parameters with missing "in" property as well as did not dereference schemas from global "parameters" and "responses" sections. Now, swagger files with parameters and responses that just refer to schemas in "parameters" and "responses" section are loaded successfully.

#### 1.0.6
- #4757: Changed SCM repository and associated internal cleanup.
- #4760: Correctly trigger default response.
 Previously service connectors and flow-nodes generated with api-builder-plugin-fn-swagger did not handle the cases where the swagger definition have default response.
 Now service connectors and flow-nodes generated with api-builder-plugin-fn-swagger will use the proper response description even when default descriptions exists. For example if the service returns http code 301 and there is no response defined for 301 the "default" response will be used if present in the swagger document.

## License

This code is proprietary, closed source software licensed to you by Axway. All Rights Reserved. You may not modify Axwayâ€™s code without express written permission of Axway. You are licensed to use and distribute your services developed with the use of this software and dependencies, including distributing reasonable and appropriate portions of the Axway code and dependencies. Except as set forth above, this code MUST not be copied or otherwise redistributed without express written permission of Axway. This module is licensed as part of the Axway Platform and governed under the terms of the Axway license agreement (General Conditions) located here: [https://support.axway.com/en/auth/general-conditions](https://support.axway.com/en/auth/general-conditions); EXCEPT THAT IF YOU RECEIVED A FREE SUBSCRIPTION, LICENSE, OR SUPPORT SUBSCRIPTION FOR THIS CODE, NOTWITHSTANDING THE LANGUAGE OF THE GENERAL CONDITIONS, AXWAY HEREBY DISCLAIMS ALL SUPPORT AND MAINTENANCE OBLIGATIONS, AS WELL AS ALL EXPRESS AND IMPLIED WARRANTIES, INCLUDING BUT NOT LIMITED TO IMPLIED INFRINGEMENT WARRANTIES, WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, AND YOU ACCEPT THE PRODUCT AS-IS AND WITH ALL FAULTS, SOLELY AT YOUR OWN RISK. Your right to use this software is strictly limited to the term (if any) of the license or subscription originally granted to you.
