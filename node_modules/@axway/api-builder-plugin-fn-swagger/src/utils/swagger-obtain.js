const fs = require('fs');
const path = require('path');
const dirs = require('./dirs');

/**
 * @return {Array} the list with service swaggers that has to be processed
 */
module.exports = () => {
	const items = [];
	if (fs.existsSync(dirs.swaggersLocation())) {
		const [ swaggerFileNames, icons ] = fs.readdirSync(dirs.swaggersLocation()).reduce((data, file) => {
			const [ sfn, ico ] = data;
			const extension = path.extname(file);
			const fileNameNoExtension = file.replace(extension, '');
			if (extension === '.json') {
				sfn.push({
					name: fileNameNoExtension,
					extension
				});
			} else if (file.match(/\.(?:bmp|jpeg|jpg|png|gif|tiff|svg)$/)) {
				if (!ico[fileNameNoExtension]) {
					ico[fileNameNoExtension] = [];
				}
				ico[fileNameNoExtension].push(file);
			}
			return data;
		}, [[], {}]);
		swaggerFileNames.forEach((file) => {
			const fileName = file.name;
			items.push({
				fileName,
				swagger: dirs.getSwagger(fileName),
				icon: icons[fileName] ? dirs.getIconLocation(icons[fileName][0]) : null,
				absolute_path: dirs.getSwaggerPath(fileName, file.extension)
			});
		});
	}
	return items;
};
