exports = module.exports = {
	enableGracefulDestroy
};

/**
 * Helps in destroying idle sockets when closing the server.
 *
 * @param {*} server the decorated server
 */
function enableGracefulDestroy(server) {
	const sockets = {};
	let nextSocketId = 0;
	server.on('connection', (socket) => {
		const socketId = nextSocketId++;
		sockets[socketId] = socket;
		socket.on('close', () => {
			delete sockets[socketId];
		});
	});

	server.destroy = (cb) => {
		for (let key in sockets) {
			sockets[key].destroy();
		}
		server.close(cb);
	};
}
