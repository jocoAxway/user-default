const APIProvider = require('../APIProvider');

/**
 * API for interacting with the Axway Schema repository.
 * @public
 */
class SchemaAPI extends APIProvider {
	/**
	 * Bind the paths to the controller methods.
	 *
	 * @param {SchemaController} controller - The main controller providing the
	 *                                         implementation for this API.
	 */
	static bind(controller) {
		const swagger = controller.ctx.swagger;

		swagger.schema('Schema', { $ref: '#' });

		swagger
			.get('/schema')
			.operationId('getSchemas')
			.tag('schema')
			.summary('Gets all the registered schemas.')
			.response(200, 'OK', 'Schema', true)
			.response(500)
			.action((req, res) => {
				controller.getSchemas()
					.then(schemas => {
						res.status(200).send(schemas);
					})
					.catch(err => {
						APIProvider.handleError(err, res, 500);
					});
			});

		swagger
			.get('/schema/:id')
			.operationId('getSchemaById')
			.tag('schema')
			.summary('Gets the schema by id.')
			.parameter({ in: 'path', name: 'id', type: 'string', description: 'The schema id.' })
			.response(200, 'OK', 'Schema')
			.response(404)
			.response(500)
			.action((req, res) => {
				const id = decodeURIComponent(req.params.id);
				controller.getSchema(id)
					.then(schema => {
						res.status(200).send(schema);
					})
					.catch(err => {
						APIProvider.handleError(err, res, 404, 500);
					});
			});
	}
}

exports = module.exports = SchemaAPI;
